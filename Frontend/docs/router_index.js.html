<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: router/index.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: router/index.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { createRouter, createWebHistory } from 'vue-router'
import { useAuthStore } from '@/stores/auth'

import HomeView from '../views/HomeView.vue'
import LoginView from '../views/auth/LoginView.vue'
import TiendaView from '../views/store/TiendaView.vue'
import AgregarProductoView from '../views/vendedor/VenderView.vue'
import VenderView from '../views/vendedor/VendedorProductosView.vue'
import EditarProductoView from '../views/vendedor/EditarProductoView.vue'
import ProductoDetalleView from '../views/store/ProductoDetalleView.vue'
import CarritoView from '../views/checkout/CarritoView.vue'
import AgregarDomicilioView from '../views/checkout/AgregarDomicilioView.vue'
import SeleccionarDireccionView from '../views/checkout/SeleccionarDireccionView.vue'
import PerfilView from '../views/perfil/PerfilView.vue'
import PagoTarjetaView from '../views/checkout/PagoTarjetaView.vue'
import MisChatsView from '../views/perfil/MisChatsView.vue'
import ReportesView from '../views/reportes/ReportesView.vue'

/**
 * @description Instancia del enrutador de Vue.
 * @type {import('vue-router').Router}
 */
const router = createRouter({
  /**
   * @description Configuración del historial de navegación.
   * Utiliza el modo de historial web para URLs limpias.
   */
  history: createWebHistory(import.meta.env.BASE_URL),
  /**
   * @description Definición de las rutas de la aplicación.
   * @type {import('vue-router').RouteRecordRaw[]}
   */
  routes: [
    {
      path: '/',
      name: 'home',
      component: HomeView,
      meta: { title: 'S-mart' },
    },
    {
      path: '/login',
      name: 'login',
      component: LoginView,
      meta: {
        title: 'Login - S-mart',
        requiresGuest: true, //
      },
    },

    {
      path: '/compra-exitosa',
      name: 'compra-exitosa',
      component: () => import('../views/checkout/CompraExitosaView.vue'),
      meta: {
        title: 'Compra Exitosa - S-mart',
        requiresAuth: true,
      },
    },

    {
      path: '/carrito',
      name: 'carrito',
      component: CarritoView,
      meta: { title: 'Carrito - S-mart' },
    },
    {
      path: '/pago-tarjeta',
      name: 'pago-tarjeta',
      component: PagoTarjetaView,
      meta: {
        title: 'Pago con Tarjeta - S-mart',
        requiresAuth: true,
      },
    },

    {
      path: '/seleccionar-direccion',
      name: 'seleccionar-direccion',
      component: SeleccionarDireccionView,
      meta: { title: 'Seleccionar Dirección - S-mart' },
    },
    {
      path: '/agregar-domicilio',
      name: 'agregar-domicilio',
      component: AgregarDomicilioView,
      meta: { title: 'Registrar Domicilio - S-mart' },
    },
    {
      path: '/editar-domicilio/:id',
      name: 'editar-domicilio',
      component: () => import('../views/checkout/EditarDomicilioView.vue'),
      meta: {
        title: 'Editar Domicilio - S-mart',
        requiresAuth: true,
      },
    },

    {
      path: '/tienda',
      name: 'tienda',
      component: TiendaView,
      meta: { title: 'Tienda - S-mart' },
    },
    {
      path: '/producto/:id', // URL dinámica que captura el ID
      name: 'producto-detalle', // Nombre único para la ruta
      component: ProductoDetalleView,
      props: true,
      meta: { title: 'Producto - S-mart' },
    },
    {
      path: '/AgregarProducto',
      name: 'AgregarProducto',
      component: AgregarProductoView,
      meta: {
        title: 'Agregar un Producto - S-mart',
        requiresAuth: true,
        requiresRoles: ['vendedor', 'administrador'], // Solo vendedores y admins
      },
    },
    {
      path: '/admin',
      name: 'admin',
      component: () => import('../views/admin/AdminView.vue'),
      meta: {
        title: 'Panel de Administración - S-mart',
        requiresAuth: true,
        requiresRoles: ['administrador'],
      },
    },
    {
      path: '/vendedor',
      name: 'vendedor',
      component: VenderView,
      meta: {
        title: 'Agregar un Producto - S-mart',
        requiresAuth: true,
        requiresRoles: ['vendedor', 'administrador'],
      },
    },
    {
      path: '/admin/productos',
      name: 'admin-productos',
      component: () => import('../views/admin/AdminProductosView.vue'),
      meta: {
        title: 'Productos - Admin',
        requiresAuth: true,
        requiresRoles: ['administrador'],
      },
    },
    {
      path: '/admin/categorias',
      name: 'admin-categorias',
      component: () => import('../views/admin/AdminCategoriasView.vue'),
      meta: {
        title: 'Categorías - Admin',
        requiresAuth: true,
        requiresRoles: ['administrador'],
      },
    },
    {
      path: '/admin/usuarios',
      name: 'admin-usuarios',
      component: () => import('../views/admin/AdminUsuariosView.vue'),
      meta: {
        title: 'Usuarios - Admin',
        requiresAuth: true,
        requiresRoles: ['administrador'],
      },
    },
    {
      path: '/EditarProducto/:id',
      name: 'EditarProducto',
      component: EditarProductoView,
      meta: {
        title: 'Editar Producto - S-mart',
        requiresAuth: true,
        requiresRoles: ['vendedor', 'administrador'],
      },
    },
    {
      path: '/VendedorProductos',
      name: 'VendedorProductos',
      component: VenderView,
      meta: {
        title: 'Mis Productos - S-mart',
        requiresAuth: true,
        requiresRoles: ['vendedor', 'administrador'],
      },
    },

    {
      path: '/perfil',
      name: 'perfil',
      component: PerfilView,
      meta: {
        title: 'Mi Perfil - S-mart',
        requiresAuth: true,
        // Permitimos que todos los roles vean su perfil
        requiresRoles: ['cliente', 'vendedor', 'administrador', 'cajero'],
      },
    },

    {
      path: '/mis-chats',
      name: 'mis-chats',
      component: MisChatsView,
      meta: {
        title: 'Mis Chats - S-mart',
        requiresAuth: true,
        requiresRoles: ['cliente', 'vendedor', 'administrador', 'cajero'],
      },
    },

    {
      path: '/cajero',
      name: 'cajero',
      component: () => import('../views/cajero/CajeroView.vue'),
      meta: {
        title: 'Panel de Cajero - S-mart',
        requiresAuth: true,
        requiresRoles: ['cajero', 'administrador'],
      },
    },
    {
      path: '/reset-password',
      name: 'reset-password',
      component: () => import('@/views/auth/ResetPasswordView.vue'),
    },
    {
      path: '/reportes',
      name: 'reportes',
      component: ReportesView,
      meta: {
        title: 'Reporte de Ventas - S-mart',
        requiresAuth: true,
        requiresRoles: ['administrador', 'vendedor', 'cajero'],
      },
    },
    {
      path: '/vendedor/pedidos',
      name: 'vendedor-pedidos',
      component: () => import('../views/vendedor/VendedorPedidosView.vue'),
      meta: {
        title: 'Gestión de Pedidos - S-mart',
        requiresAuth: true,
        requiresRoles: ['vendedor', 'administrador'],
      },
    },
    {
      path: '/seguimiento',
      name: 'seguimiento-envio',
      component: () => import('../views/perfil/SeguimientoEnvioView.vue'),
      meta: {
        title: 'Seguimiento de Envíos - S-mart',
        requiresAuth: true,
        requiresRoles: ['cliente', 'vendedor', 'administrador', 'cajero'],
      },
    },
    {
      path: '/venta/:id',
      name: 'detalle-venta',
      component: () => import('../views/perfil/DetalleVentaView.vue'),
      meta: {
        title: 'Detalle de Pedido - S-mart',
        requiresAuth: true,
        requiresRoles: ['cliente', 'vendedor', 'administrador', 'cajero'],
      },
    },
    /* {
      path: '/perfil',
      name: 'perfil',
      component: () => import('../views/PerfilView.vue'),
      meta: {
        title: 'Mi Perfil - S-mart',
        requiresAuth: true,
        requiresRoles: ['cliente', 'vendedor', 'administrador', 'cajero'],
      },
    },
    {
      path: '/:pathMatch(.*)*',
      name: 'not-found',
      component: () => import('../views/NotFoundView.vue'),
      meta: { title: '404 - S-mart' },
    } */
  ],
  /**
   * @description Controla el comportamiento del scroll al navegar.
   * @param {import('vue-router').RouteLocationNormalized} to - La ruta de destino.
   * @param {import('vue-router').RouteLocationNormalizedLoaded} from - La ruta de origen.
   * @param {import('vue-router').ScrollPosition | null} savedPosition - La posición guardada del scroll si existe.
   * @returns {import('vue-router').ScrollPosition | { top: number }} La posición del scroll.
   */
  scrollBehavior(to, from, savedPosition) {
    if (savedPosition) {
      return savedPosition
    } else {
      return { top: 0 }
    }
  },
})

/**
 * @description Guardia de navegación global que se ejecuta antes de cada cambio de ruta.
 * Controla el acceso a rutas protegidas y actualiza el título del documento.
 * @param {import('vue-router').RouteLocationNormalized} to - La ruta de destino.
 * @param {import('vue-router').RouteLocationNormalizedLoaded} from - La ruta de origen.
 * @param {import('vue-router').NavigationGuardNext} next - Función para resolver el gancho de navegación.
 */
router.beforeEach(async (to, from, next) => {
  document.title = to.meta.title || 'S-mart'

  const authStore = useAuthStore()

  // Si está cargando, esperar máximo 3 segundos
  if (authStore.loading) {
    const timeout = new Promise((resolve) => setTimeout(resolve, 3000))
    const loadingDone = new Promise((resolve) => {
      const unwatch = authStore.$subscribe(() => {
        if (!authStore.loading) {
          unwatch()
          resolve()
        }
      })
      // Si ya no está loading cuando se crea la suscripción
      if (!authStore.loading) {
        unwatch()
        resolve()
      }
    })

    await Promise.race([loadingDone, timeout])
  }

  const isAuthenticated = !!authStore.usuario
  const userRole = authStore.rolUsuario

  // Si requiere ser invitado (como /login) pero ya está logueado
  if (to.meta.requiresGuest &amp;&amp; isAuthenticated) {
    // Comprueba si hay una redirección guardada
    try {
      const redirectPath = localStorage.getItem('authRedirect')
      if (redirectPath) {
        localStorage.removeItem('authRedirect') // Limpia el storage
        return next(redirectPath) // Envía al usuario a donde quería ir
      }
    } catch (e) {
      console.warn('Error leyendo authRedirect:', e)
    }
    // Si no hay nada guardado, envía a 'home'
    return next({ name: 'home' })
  }

  // Si requiere autenticación y NO está logueado
  if (to.meta.requiresAuth &amp;&amp; !isAuthenticated) {
    // Guarda la ruta completa (incluyendo queries) a la que intentaba acceder
    try {
      localStorage.setItem('authRedirect', to.fullPath)
    } catch (e) {
      console.warn('Error guardando authRedirect:', e)
    }
    return next({ name: 'login' })
  }

  // Si requiere roles específicos
  if (to.meta.requiresRoles &amp;&amp; Array.isArray(to.meta.requiresRoles)) {
    if (!isAuthenticated) {
      // Guarda la ruta completa y manda a login
      try {
        localStorage.setItem('authRedirect', to.fullPath)
      } catch (e) {
        console.warn('Error guardando authRedirect:', e)
      }
      return next({ name: 'login' })
    }

    if (!to.meta.requiresRoles.includes(userRole)) {
      if (authStore.esAdmin) {
        return next({ name: 'admin' })
      } else if (authStore.esVendedor) {
        return next({ name: 'vendedor' })
      } else {
        return next({ name: 'home' })
      }
    }
  }

  next()
})

export default router
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-useAuthStore.html">useAuthStore</a></li><li><a href="module-useCartStore.html">useCartStore</a></li><li><a href="module-useChat.html">useChat</a></li><li><a href="module-useCounterStore.html">useCounterStore</a></li><li><a href="module-useCreditCardFormatters.html">useCreditCardFormatters</a></li><li><a href="module-useNotificationStore.html">useNotificationStore</a></li><li><a href="module-usePaymentCheckout.html">usePaymentCheckout</a></li><li><a href="module-useProductStore.html">useProductStore</a></li><li><a href="module-useRole.html">useRole</a></li><li><a href="module-useTicketGenerator.html">useTicketGenerator</a></li><li><a href="module-useVentasStore.html">useVentasStore</a></li></ul><h3>Global</h3><ul><li><a href="global.html#LOW_STOCK_THRESHOLD">LOW_STOCK_THRESHOLD</a></li><li><a href="global.html#history">history</a></li><li><a href="global.html#redirectUrl">redirectUrl</a></li><li><a href="global.html#router">router</a></li><li><a href="global.html#routes">routes</a></li><li><a href="global.html#scrollBehavior">scrollBehavior</a></li><li><a href="global.html#subirImagenCloudinary">subirImagenCloudinary</a></li><li><a href="global.html#supabase">supabase</a></li><li><a href="global.html#supabaseAnonKey">supabaseAnonKey</a></li><li><a href="global.html#supabaseUrl">supabaseUrl</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Sat Nov 29 2025 17:14:20 GMT-0600 (hora estándar central)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
