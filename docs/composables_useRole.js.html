<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: composables/useRole.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: composables/useRole.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// Frontend/src/composables/useRole.js
import { computed } from 'vue'
import { useAuthStore } from '@/stores/auth'
import { useRouter, useRoute } from 'vue-router'

/**
 * @module useRole
 * @description Composable para la gestión de roles y autenticación de usuarios.
 * Proporciona una serie de propiedades computadas y funciones para verificar
 * el estado de autenticación, los roles del usuario y los permisos asociados.
 */
export function useRole() {
  const authStore = useAuthStore()
  const router = useRouter()
  const route = useRoute()

  /**
   * @type {import('vue').ComputedRef&lt;boolean>}
   * @description Indica si el usuario está actualmente autenticado.
   */
  const isAuthenticated = computed(() => !!authStore.usuario)

  /**
   * @type {import('vue').ComputedRef&lt;string|null>}
   * @description Devuelve el rol actual del usuario autenticado.
   */
  const currentRole = computed(() => authStore.rolUsuario)

  /**
   * Verifica si el usuario actual tiene uno de los roles especificados.
   * @param {string|string[]} roles - Un único rol o un array de roles a verificar.
   * @returns {boolean} `true` si el usuario tiene al menos uno de los roles, de lo contrario `false`.
   */
  const hasRole = (roles) => {
    if (!Array.isArray(roles)) {
      roles = [roles]
    }
    return roles.includes(authStore.rolUsuario)
  }

  /**
   * Alias de `hasRole`. Verifica si el usuario tiene alguno de los roles proporcionados.
   * @param {string[]} roles - Un array de roles a verificar.
   * @returns {boolean} `true` si el usuario tiene al menos uno de los roles, de lo contrario `false`.
   */
  const hasAnyRole = (roles) => {
    if (!Array.isArray(roles)) {
      roles = [roles]
    }
    return roles.some((role) => role === authStore.rolUsuario)
  }

  /**
   * Verifica si el usuario actual tiene todos los roles especificados.
   * @param {string[]} roles - Un array de roles a verificar.
   * @returns {boolean} `true` si el usuario tiene todos los roles especificados, de lo contrario `false`.
   */
  const hasAllRoles = (roles) => {
    if (!Array.isArray(roles)) {
      roles = [roles]
    }
    return roles.every((role) => role === authStore.rolUsuario)
  }

  /**
   * Exige que el usuario tenga un rol específico para acceder a una ruta.
   * Si no tiene el rol, muestra una alerta y redirige.
   * @param {string|string[]} roles - El rol o roles requeridos.
   * @param {string} [redirectTo='/'] - La ruta a la que se redirigirá si el usuario no tiene el rol.
   * @returns {boolean} `true` si el usuario tiene el rol, `false` si es redirigido.
   */
  const requireRole = (roles, redirectTo = '/') => {
    if (!hasRole(roles)) {
      alert('No tienes permisos para acceder a esta página')
      router.push(redirectTo)
      return false
    }
    return true
  }

  /**
   * Exige que el usuario esté autenticado para acceder a una ruta.
   * Si no está autenticado, guarda la ruta actual y redirige a la página de login.
   * @param {string} [redirectTo='/login'] - La ruta a la que se redirigirá si el usuario no está autenticado.
   * @returns {boolean} `true` si el usuario está autenticado, `false` si es redirigido.
   */
  const requireAuth = (redirectTo = '/login') => {
    if (!isAuthenticated.value) {
      try {
        localStorage.setItem('authRedirect', route.fullPath)
      } catch (e) {
        console.warn('Error guardando authRedirect:', e)
      }
      router.push(redirectTo)
      return false
    }
    return true
  }

  /** @type {import('vue').ComputedRef&lt;boolean>} */
  const isAdmin = computed(() => authStore.esAdmin)
  /** @type {import('vue').ComputedRef&lt;boolean>} */
  const isVendedor = computed(() => authStore.esVendedor)
  /** @type {import('vue').ComputedRef&lt;boolean>} */
  const isCliente = computed(() => authStore.esCliente)
  /** @type {import('vue').ComputedRef&lt;boolean>} */
  const isCajero = computed(() => authStore.esCajero)
  /** @type {import('vue').ComputedRef&lt;boolean>} */
  const isInvitado = computed(() => authStore.esInvitado)

  /**
   * @type {import('vue').ComputedRef&lt;boolean>}
   * @description Determina si el usuario puede vender (si es Vendedor o Admin).
   */
  const canSell = computed(() => authStore.esVendedor || authStore.esAdmin)
  /**
   * @type {import('vue').ComputedRef&lt;boolean>}
   * @description Determina si el usuario puede gestionar otros usuarios (solo Admin).
   */
  const canManageUsers = computed(() => authStore.esAdmin)
  /**
   * @type {import('vue').ComputedRef&lt;boolean>}
   * @description Determina si el usuario puede acceder al panel de administración (solo Admin).
   */
  const canAccessAdmin = computed(() => authStore.esAdmin)
  /**
   * @type {import('vue').ComputedRef&lt;boolean>}
   * @description Determina si el usuario puede realizar compras.
   */
  const canBuy = computed(() => authStore.esCliente || authStore.esVendedor || authStore.esAdmin)

  return {
    // Estado
    isAuthenticated,
    currentRole,

    // Verificaciones
    hasRole,
    hasAnyRole,
    hasAllRoles,
    requireRole,
    requireAuth,

    // Roles específicos
    /**
     * @property {import('vue').ComputedRef&lt;boolean>} isAdmin - `true` si el usuario es Administrador.
     */
    isAdmin,
    /**
     * @property {import('vue').ComputedRef&lt;boolean>} isVendedor - `true` si el usuario es Vendedor.
     */
    isVendedor,
    /**
     * @property {import('vue').ComputedRef&lt;boolean>} isCliente - `true` si el usuario es Cliente.
     */
    isCliente,
    /**
     * @property {import('vue').ComputedRef&lt;boolean>} isCajero - `true` si el usuario es Cajero.
     */
    isCajero,
    /**
     * @property {import('vue').ComputedRef&lt;boolean>} isInvitado - `true` si el usuario no está autenticado.
     */
    isInvitado,

    // Permisos
    canSell,
    canManageUsers,
    canAccessAdmin,
    canBuy,
  }
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-useAuthStore.html">useAuthStore</a></li><li><a href="module-useCartStore.html">useCartStore</a></li><li><a href="module-useChat.html">useChat</a></li><li><a href="module-useCounterStore.html">useCounterStore</a></li><li><a href="module-useCreditCardFormatters.html">useCreditCardFormatters</a></li><li><a href="module-useNotificationStore.html">useNotificationStore</a></li><li><a href="module-usePaymentCheckout.html">usePaymentCheckout</a></li><li><a href="module-useProductStore.html">useProductStore</a></li><li><a href="module-useRole.html">useRole</a></li><li><a href="module-useTicketGenerator.html">useTicketGenerator</a></li></ul><h3>Global</h3><ul><li><a href="global.html#LOW_STOCK_THRESHOLD">LOW_STOCK_THRESHOLD</a></li><li><a href="global.html#history">history</a></li><li><a href="global.html#redirectUrl">redirectUrl</a></li><li><a href="global.html#router">router</a></li><li><a href="global.html#routes">routes</a></li><li><a href="global.html#scrollBehavior">scrollBehavior</a></li><li><a href="global.html#subirImagenCloudinary">subirImagenCloudinary</a></li><li><a href="global.html#supabase">supabase</a></li><li><a href="global.html#supabaseAnonKey">supabaseAnonKey</a></li><li><a href="global.html#supabaseUrl">supabaseUrl</a></li><li><a href="global.html#useVentasStore">useVentasStore</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Tue Dec 02 2025 21:46:59 GMT-0600 (hora estándar central)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
